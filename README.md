# RPlatform

Arduino-библиотека для управления РОББО Платформой.

## Установка

По ссылке перейдите на [страницу релиза последней версии](https://github.com/skyfroger/RPlatform/releases/latest).

В разделе **Assets** скачайте архив с названием **Source code (zip)**. Файл будет называться **RPlatform-[версия].zip**.

Откройте **Arduino IDE**. Выберите пункт меню **Скетч - Подключить библиотеку - Добавить .ZIP библиотеку...** . В появившемся диалоговом окне выберите сохранённый ранее архив.

Библиотека установлена.

## Примеры скетчей

Примеры можно найти в меню **Файл - Примеры - RPlatform**.

## Подключение

Для импорта библиотеки в скетч, нужно добавить в начале следующую строку:

```c++
#include <RPlatform.h>
```

Добавить эту строку можно вручную или с помощью меню **Скетч - Подключить библиотеку - RPlatform**.

## Документация

Перед тем, как обращаться к методам, нужно создать объект класса `RPlatform`:

```c++
#include <RPlatform.h> // подключение библиотеки

// объект класса RPlatform создаётся вне функции setup() и loop()
RPlatform robot;

void setup(){
    // начальная настройка
}

void loop(){
    // главыный цикл Arduino-скетча
}
```

### Чтение показаний датчика

```c++
int readSensor(int portNumber, bool raw = false);
```

Функция возвращает показания датчика на позиции с номером `portNumber`. Значение показаний находятся в диапазоне *0..100*. Если вторым аргументом передать значение `true`, то функция вернёт *сырое* значение (*0..1023*).

Пример:

```c++
int sensor = robot.readSensor(1); // данные с датчика на первой позиции
int rawData = robot.readSensor(2, true); // сырые данные с датчика на второй позиции
```

### Кнопка START

```c++
bool isStartPressed();
```

Функция возвращает `true`, если кнопка START нажата, иначе возвращается `false`.

Пример:

```c++
// цикл выполняется, пока кнопка не нажата
while(!robot.isStartPressed()) {}
```

С помощью такого цикла можно остановить программу до нажатия на кнопку START.

### Мощность моторов

```c++
void setPower(int power);
void setPower(int powerL, int powerR);
```

С помощью функции можно изменить мощность, как обоих моторов одновременно, так и по отдельности. Значение мощности указывается в диапазоне *0..100*. Если указать значение, которое выходит за диапазон, то оно будет приведено к ближайшему допустимому - *0* или *100*.

Пример:

```c++
robot.setPower(40); // мощность обоих моторов - 40
robot.setPower(5, 30); // левый мотор - 5, правый мотор - 30
```

### Направление вращения моторов

```c++
void setDirection(direction dir);
void setDirection(direction dirL, direction dirR);
```

Функция задаёт направление вращения моторов. В качестве аргументов передаются два возможных значения-константы:

```c++
FW // движение вперёд (forward)
BW // движение назад (backward)
```

Пример:

```c++
robot.setDirection(FW); // направление обоих двигателей - "вперёд"
robot.setDirection(BW); // направление обоих двигателей - "назад"
robot.setDirection(BW, FW); // левый двигатель - "назад", правый двигатель - "вперёд"
```

### Одновременная настройка мощности и направления вращения

```c++
void setRunSettings(direction dirL, direction dirR, int powerL, int powerR);
```

Функция позволяет изменить направление вращения левого двигателя `dirL` и правого двигателя `dirR`, а также мощность левого двигателя `powerL` и правого двигателя `powerR`.

Пример:

```c++
/*
Направление обоих двигателей - "вперёд"
Мощность левого мотора - 10
Мощность правого мотора - 20
*/
robot.setRunSettings(FW, FW, 10, 20);

/*
Направление левого двигателя - "назад"
Направление правого двигателя - "вперёд"
Мощность обоих двигателей - 35
*/
robot.setRunSettings(BW, FW, 35, 35);
```

### Запуск и остановка моторов

```c++
void run(); // запуск моторов
```

```c++
void run(); // остановка моторов
```

Моторы работают до тех пор, пока не будут остановлены функцией `stopMotors()`.

Пока моторы запущены, можно менять их мощность и направление вращения. Изменения сразу будут отражаться на поведении платформы.

### Запуск моторов на определённое время

```c++
void runTime(float seconds);
```

Функция запустит двигатели на `seconds` секунд.

Пример:

```c++
robot.setDirection(FW); // направление движения - "вперёд"
robot.setPower(20); // мощность - 20

// Платформа будет ехать прямо 4 секунды
robot.runTime(4);

robot.setDirection(BW); // направление движения - "назад"
// Платформа будет ехать назад пол секунды
robot.runTime(0.5);
```

### Запуск моторов на определённое количество шагов

```c++
void runSteps(int steps);
```

Функция запускает двигатели на `steps` шагов.

> Полный оборот колеса приблизительно занимает 24 шага.

Пример:

```c++
robot.runSteps(200); // запуск платформы на 200 шагов
```

### Запуск моторов на определённый угол поворота

```c++
void runAngle(int angle);
```

С помощью функции можно указать на какой угол должны повернуться колёса платформы.

Пример:

```c++
robot.runAngle(180); // колёса повернуться на 180 градусов и платформа остановится
```

### Поворот платформы на указанный угол

```c++
void turnLeft(int angle); // поворот налево
```

```c++
void turnRight(int angle); // попорот направо
```

Платформа повернётся на угол `angle` в нужную сторону.

> Чем больше угол поворота, тем меньше его точность. Лучше не использовать данные функции для поворота платформы на угол больше 180 градусов. Накапливаемая ошибка становится слишком большой.

Пример:

```c++
robot.turnRight(45); // поворот платформы на 45 градусов вправо
robot.turnLeft(100); // поворот платформы на 100 градусов влево
```

После поворота, функция восстановит установленное до её вызова направление вращения для колёс платформы.

```c++
robot.setDirection(BW); // направление движения - назад
robot.runTime(2); // движение назад в течении 2 секунд
robot.turnRight(45); // поворот направо на 45 градусов
robot.runTime(2); // платформа опять поедет назад 
```

